buildscript {
  repositories {
    jcenter()
  }

  dependencies {
    classpath 'org.anarres.gradle:gradle-sablecc-plugin:[1.0.4,)'
    classpath "com.prezi.pride:gradle-pride-plugin:0.11"
  }
}

// task test(type: Test) {
//   childProjects.each { _, Project child ->
//     try {
//       print child.tasks//.getByName("test")
//     } catch (UnknownTaskException e) { println ("the " + child + " has no test") }
//   }
// }

// ask test(type: Test) {
//  dependsOn {
//    rootProject.subprojects.collect {
//      it.tasks.getByName 'test'
//    }
//  }
// 

subprojects {
  group='org.openflexo'
  apply plugin: 'java'
  apply plugin: 'pride'

  project.buildDir = 'target'
  
  repositories {
    jcenter()
  }
 
  dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.+'
  }

  test {
    testLogging {
      // Show that tests are run in the command-line output
      //events 'passed' //'started'
      //showStandardStreams = true
    }
  }

  if (JavaVersion.current().isJava8Compatible()) {
    allprojects {
      tasks.withType(Javadoc) {
	options.addBooleanOption('Xdoclint:none', true)
      }
    }
  }

  task testJar(type: Jar) {
    classifier = 'tests'
    from sourceSets.test.output
  }

  task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
  }

  task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
  }

  artifacts {
    archives sourcesJar
    archives javadocJar
    archives testJar
  }
}

apply plugin: 'maven'

archivesBaseName = rootProject.name
group = 'org.openflexo'
version = '1.4-SNAPSHOT'

uploadArchives {
  repositories {
    mavenDeployer {
      repository(url: 'file:./maven')
    }
  }
}
